---
title: "Running Noisewalker"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{run_noisewalker}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r}
# prepare parameter combinations
library(noisewalker)
library(data.table)
library(ggplot2)

# get data.table of parameter combinations
data <- CJ(gmax = 1000,
           tmax = 10,
           nOctaves = 2, 
           frequency = seq(0.001, 8, 1),
           ftransfer = seq(0.001, 8, 1),
           srange = 0.5,
           repl = as.character(seq(3)))
```


```{r setup}
library(noisewalker)

# run over generations
invisible(
  Map(function(gmax, tmax, oct, f, ft, srange, rep) {
    noisewalker::run_noisewalker(gmax, tmax, oct, f, ft, srange, rep)
  }, 
  data$gmax, data$tmax, data$nOctaves, data$frequency,
  data$ftransfer, data$srange, data$repl)
)
```

## Population transfer experiment

```{r}
# read data
data <- fread("data/1604255887875.csv")
```

```{r}
# plot figure
ggplot(data)+
  geom_path(aes(gen, mass_mean,
                      ymin = mass_mean - mass_sd,
                      ymax = mass_mean + mass_sd,
                      col = gen < 1000),
                  size = 0.5,
                  show.legend = F)+
  scale_color_brewer(palette = "Dark2")+
  scale_y_continuous(trans = ggallin::pseudolog10_trans,
                     limits = c(0, 3))

ggsave("figures/fig_transfer_2.png", dpi = 300)
```

